C51 COMPILER V8.01   MAIN                                                                  10/28/2009 22:03:39 PAGE 1   


C51 COMPILER V8.01, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN main.OBJ
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE main.c ROM(COMPACT) BROWSE INCDIR(.;.\driver) DEBUG OBJECTEXTEND

line level    source

   1          #include "config.h"
   2          #include <adc.h>
   3          #include <adc0832.h>
   4          
   5          #include <math.h>
   6          #include <charger.h>
   7          
   8          
   9           
  10          
  11          static unsigned short n,x,adc_i=0,adc_v=0;
  12          static unsigned short onduty=0;
  13          
  14          extern float charging_current, battery_voltage;
  15          extern float  refV ; 
  16          
  17          
  18          
  19          
  20          void icharger_testcontrolkey(char fx)
  21          {
  22   1        
  23   1              if(10==fx){ // key a
  24   2                    //vledmod(VLED_A); 
  25   2                   // print10((short)charging_current);
  26   2                        setdot(0);
  27   2              }
  28   1              
  29   1              if(11==fx){ // key b 
  30   2                   //vledmod(VLED_V); 
  31   2                  // print10((short)(battery_voltage*100));
  32   2                   setdot(1); 
  33   2      
  34   2              } 
  35   1                      
  36   1              if(12==fx){ //key c
  37   2                   print10(adc_i);
  38   2                   setdot(-1);
  39   2              }
  40   1              if(13==fx){ //key d
  41   2                              setdot(-1);
  42   2                              print10(adc_v);
  43   2              }   
  44   1      
  45   1              if(14==fx){ // key e
  46   2                 refV=5.03;
  47   2              }
  48   1      
  49   1              if(15==fx){ // key f
  50   2                  print10(onduty);
  51   2                      //vledmod(VLED_HZ); 
  52   2              }
  53   1      
  54   1      }
  55          void main()
C51 COMPILER V8.01   MAIN                                                                  10/28/2009 22:03:39 PAGE 2   

  56          {
  57   1         char fx= 0;
  58   1         pwm_init(); //pull down pwm
  59   1         /*power on test*/
  60   1       
  61   1         segvled_init();
  62   1      
  63   1         timer0_init();
  64   1         timer1_init();
  65   1      
  66   1         //adc_init(); 
  67   1         fx = 11;
  68   1         irqon();   //enable global interrupt         
  69   1         sleep(0); // just refrence 
  70   1         while(1){ 
  71   2      
  72   2                  charging();   //charger auto control
  73   2                         
  74   2              n = keyscan();
  75   2                      if(n<=15 && n>=10) /*A .. F*/
  76   2                         fx = n;
  77   2              
  78   2                      
  79   2                      if(n!=-1)
  80   2                      {
  81   3                         if(n == 15){ // key F
  82   4                               pwm_setduty(onduty);
  83   4                               onduty = 0;
  84   4                 }else if(n<10) {     
  85   4                            if( 9==n)
  86   4                                   x=0;
  87   4                                else
  88   4                               x=(n+1);       
  89   4                                onduty = 10*onduty+x;   
  90   4                                print10(onduty);
  91   4                         }
  92   3            
  93   3                      }
  94   2      
  95   2                      //icharger_testcontrolkey(fx);
  96   2                  update_vled(); //vled mode 
  97   2           
  98   2        }
  99   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    247    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     10       2
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
