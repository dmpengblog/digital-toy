C51 COMPILER V8.01   MAIN                                                                  10/18/2009 23:24:47 PAGE 1   


C51 COMPILER V8.01, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN main.OBJ
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE main.c BROWSE INCDIR(.;.\driver) DEBUG OBJECTEXTEND

line level    source

   1          #include "config.h"
   2          #include <adc.h>
   3          
   4          #include <intrins.h>
   5           
   6          
   7          
   8          void main()
   9          {
  10   1         pwm_init(); //pull down pwm
  11   1         /*power on test*/
  12   1       
  13   1         segvled_init();
  14   1      
  15   1         timer0_init();
  16   1         timer1_init();
  17   1      
  18   1         adc_init(); 
  19   1         vledmod('A');
  20   1      
  21   1         irqon();   //enable global interrupt         
  22   1         
  23   1         while(1){ 
  24   2             static unsigned short n,x,adc=0,adc_v=0;
  25   2                 static unsigned short onduty=0;
  26   2                 static unsigned long lasttime=0;
  27   2      
  28   2                         
  29   2                      
  30   2                 if(timeafter(jiffers,lasttime+1000) ){                           
  31   3                      
  32   3                                      pwm_safeoff();
  33   3                                      if(0==adc) {
  34   4                                         adc = pwm_fadc();
  35   4                                  }
  36   3                                       //fast search
  37   3                                      if(adc>8){
  38   4                                           x = pwm_adc(adc-5);
  39   4                                               x+= pwm_adc(adc-5);
  40   4                                               x+= pwm_adc(adc-5);
  41   4                                               x+= pwm_adc(adc-5);
  42   4                                               adc=x>>2;
  43   4      
  44   4                                          //V= 600+((adc-24)/8)*50
  45   4                                              {
  46   5                                                float v=0;
  47   5                                                v= 650+ 6.25*((float)adc-24);
  48   5                                                v=(v/(24.917) )*10+45; //get xxx mA ,45 is delta of system
  49   5                                                adc_v=(unsigned short)v;
  50   5                                              }
  51   4                                      }else
  52   3                           adc = pwm_adc(0);
  53   3                                  pwm_safeon();
  54   3      
  55   3                                      printhex(adc_v);
C51 COMPILER V8.01   MAIN                                                                  10/18/2009 23:24:47 PAGE 2   

  56   3                                      vledmod('H'); 
  57   3                                  lasttime = jiffers;
  58   3                  }
  59   2                                 
  60   2              n = keyscan();
  61   2      
  62   2                      if(n!=-1)
  63   2                      {
  64   3                         if(n == 15){ // key F
  65   4                            pwm_setduty(onduty);
  66   4                                onduty = 0;
  67   4                 }else if(n<10) {     
  68   4                           
  69   4                    if( 9==n)
  70   4                                   x=0;
  71   4                                else
  72   4                               x=(n+1);       
  73   4                                onduty = 10*onduty+x;   
  74   4                                printhex(onduty);
  75   4                         }
  76   3      
  77   3                 if(10==n) // key A 
  78   3                            printhex(pwm_getduty());
  79   3        
  80   3                          if(11==n) // key B 
  81   3                             vledmod('A'); 
  82   3                 
  83   3                              if(12==n){ // key C  
  84   4                                  pwm_safeoff();
  85   4                              adc = pwm_adc(pwm_fadc());
  86   4                                      pwm_safeon();
  87   4                                      printhex(adc);
  88   4                                      vledmod('A'); 
  89   4                            
  90   4                              }
  91   3                              if(13==n){ // key d 
  92   4                              vledmod('V'); 
  93   4                          
  94   4                              }
  95   3                              if(15==n){ // key d 
  96   4                             
  97   4                           
  98   4                              }               
  99   3                 
 100   3                      }
 101   2                         
 102   2                      
 103   2                  //segvled_demo();
 104   2                  update_vled(); //vled mode 
 105   2           
 106   2        }
 107   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    523    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     14       4
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
C51 COMPILER V8.01   MAIN                                                                  10/18/2009 23:24:47 PAGE 3   

END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
