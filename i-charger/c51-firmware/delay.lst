C51 COMPILER V8.01   DELAY                                                                 10/18/2009 22:06:09 PAGE 1   


C51 COMPILER V8.01, COMPILATION OF MODULE DELAY
OBJECT MODULE PLACED IN delay.obj
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE driver\delay.c BROWSE INCDIR(.\driver) DEBUG OBJECTEXTEND PRINT(.\delay.lst
                    -) OBJECT(delay.obj)

line level    source

   1          
   2          /******************
   3            12M Hz
   4          
   5            1 cycle:  12/12M = 1us 
   6          
   7          *******************/
   8          #include  "config.h"
   9          
  10          /*
  11           *  run about cyc*2+2 cycle
  12           */
  13          void _2cycle(unsigned char cyc)
  14          {
  15   1         while(--cyc);         //while(--cyc) have bug when cyc==0, but we must use --cyc to genarate one inst
  16   1         /* DFFE     DJNZ     R7,delay(C:0014), 2cycle*/
  17   1      }
  18          
  19          
  20          
  21          
  22          
  23          /*
  24           * mdelay(0) : 15 cycle, 12Mhz 30us
  25           * 1ms to 256ms
  26           *  +- 50us
  27           */
  28          void mdelay(unsigned char ms)
  29          {
  30   1      
  31   1      /*
  32   1          35:    while(--t){     
  33   1      C:0x0005    1E       DEC      R6               1 cyc
  34   1      C:0x0006    EE       MOV      A,R6                 1 cyc
  35   1      C:0x0007    600C     JZ       C:0015           1 cyc
  36   1          36:      _2cycle(250); 
  37   1      C:0x0009    7FFA     MOV      R7,#0xFA         1 cyc
  38   1      C:0x000B    120027   LCALL    _2cycle(C:0027)   2 cyc
  39   1          37:         _2cycle(250); 
  40   1      C:0x000E    7FFA     MOV      R7,#0xFA             1 cyc
  41   1      C:0x0010    120027   LCALL    _2cycle(C:0027)   2 cyc
  42   1          38:    } 
  43   1      C:0x0013    80F0     SJMP     C:0005           2 cyc
  44   1      */
  45   1         while(ms--){   
  46   2           udelay(489); //²¹³¥12cyc*2 us
  47   2               udelay(499);
  48   2         }
  49   1        
  50   1      }
  51          
  52          /*
  53           * +- 50ms
  54           */
C51 COMPILER V8.01   DELAY                                                                 10/18/2009 22:06:09 PAGE 2   

  55          void sleep(unsigned char t)
  56          {
  57   1         while(t--){
  58   2               mdelay(250);
  59   2               mdelay(250);
  60   2           mdelay(250);
  61   2           mdelay(250);
  62   2         }
  63   1           
  64   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =     48    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
