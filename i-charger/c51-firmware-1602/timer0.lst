C51 COMPILER V8.01   TIMER0                                                                12/13/2009 18:48:28 PAGE 1   


C51 COMPILER V8.01, COMPILATION OF MODULE TIMER0
OBJECT MODULE PLACED IN timer0.obj
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE driver\timer0.c ROM(COMPACT) WARNINGLEVEL(1) OPTIMIZE(5,SIZE) INCDIR(.\driv
                    -er) PRINT(.\timer0.lst) OBJECT(timer0.obj)

line level    source

   1          
   2          #include  "config.h"
   3          #include  "timer.h"
   4          
   5          /*
   6           * timer0, 
   7           *   1) 1ms ticks
   8           *       2) tickless driver 
   9           */
  10          
  11          volatile unsigned  long jiffers=0;  //250us per jiffers
  12          
  13          
  14          
  15          
  16          
  17          #define settimer0(us) TH0 = (65536 - (us))>>8 ; /* (655535-us)/256 ³¬Âý!!!!*/  \
  18                                TL0 = (65536 - (us))&0xFF ; 
  19          
  20          #define settimer1(us) TH1 = (65535 - (us))>>8 ; /* (655535-us)/256 ³¬Âý!!!!*/  \
  21                                TL1 = (65535 - (us))&0xFF ; 
  22           
  23          
  24          
  25          void timer0_init()
  26          {
  27   1      
  28   1         /*  timer 0 in mode 1   */
  29   1         TMOD |= 0x2;   
  30   1            
  31   1         //settimer0(PWM_CYCLE);
  32   1         TH1 = TH0 = (256-PWM_CYCLE); //100us  15 step , 600Hz
  33   1         // enable timer 0 interrupt   
  34   1         ET0 = 1;   
  35   1         TR0 = 1; //enable timer
  36   1      
  37   1      }
  38          
  39                                           
  40          /*
  41           * Timer0: 256us, display driven ticks
  42           */
  43          /*ÖÐ¶Ï1£¬ ¼Ä´æÆ÷×é1 (ÆÕÍ¨º¯ÊýÄ¬ÈÏÓÃ¼Ä´æÆ÷×é0)*/
  44          
  45          
  46          
  47          void timer0(void) interrupt 1 using 2   
  48          {   
  49   1      
  50   1              pwm_1kHz();
  51   1      
  52   1      #if 0
                  if(PWM_PIN) { //need close PWM
                 
C51 COMPILER V8.01   TIMER0                                                                12/13/2009 18:48:28 PAGE 2   

                         PWM_PIN = 0;
                         settimer0(PWM_CYCLE-on_duty);
                   //  vledx0();
              
                       
                   }else { //need open PWM
                
                     PWM_PIN = 1;
                         settimer0(on_duty);//on_duty);
              //         vledx1();
              
                   }  
              #endif
  68   1      
  69   1      }  
  70          
  71          
  72          void timer1_init()
  73          {
  74   1        /* timer0 init */
  75   1         /*  timer 0 in mode 2   */
  76   1         TMOD |= 0x10;   
  77   1         // set timer speed   
  78   1         settimer1(MS_CYCLE);         //per 250us
  79   1      
  80   1        
  81   1         // enable timer 1 interrupt   
  82   1         ET1 = 1;   
  83   1         
  84   1         TR1 = 1; //enable timer
  85   1      
  86   1      }
  87          
  88          void timer1(void) interrupt 3 using 1   
  89          {   
  90   1               //ms_scan_segvled(); //É¨ÃèÏÔÊ¾
  91   1      
  92   1               
  93   1               jiffers++;
  94   1               settimer1(MS_CYCLE);
  95   1      }
  96          
  97          
  98          
  99          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =     98    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      4    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
