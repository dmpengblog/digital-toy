C51 COMPILER V8.01   MAIN                                                                  10/18/2009 19:02:33 PAGE 1   


C51 COMPILER V8.01, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN main.OBJ
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE main.c BROWSE INCDIR(.;.\driver) DEBUG OBJECTEXTEND

line level    source

   1          #include "config.h"
   2          #include <adc.h>
   3          
   4          #include <intrins.h>
   5           
   6          
   7          
   8          void main()
   9          {
  10   1         pwm_init(); //pull down pwm
  11   1         /*power on test*/
  12   1       
  13   1         segvled_init();
  14   1      
  15   1         timer0_init();
  16   1         timer1_init();
  17   1      
  18   1         adc_init(); 
  19   1         vledmod('A');
  20   1      
  21   1         irqon();   //enable global interrupt         
  22   1         
  23   1         while(1){ 
  24   2             static unsigned short n,x=0,x1=0;
  25   2                 static unsigned short onduty=0;
  26   2                 static unsigned long lasttime=0;
  27   2      
  28   2                         
  29   2                      
  30   2                 if(timeafter(jiffers,lasttime+1000) ){                           
  31   3                      
  32   3                                      pwm_safeoff();
  33   3                                       //fast search
  34   3                                      if(onduty>10)
  35   3                                      onduty = adc(onduty-5,15);
  36   3                                      else
  37   3                                          onduty = adc(0, 2);
  38   3                                  pwm_safeon();
  39   3      
  40   3                                      printhex(onduty);
  41   3                                      vledmod('H'); 
  42   3                                  lasttime = jiffers;
  43   3                  }
  44   2                                 
  45   2              n = keyscan();
  46   2      
  47   2                      if(n!=-1)
  48   2                      {
  49   3                         if(n == 15){ // key F
  50   4                            pwm_setduty(onduty);
  51   4                                onduty = 0;
  52   4                 }else if(n<10) {     
  53   4                           
  54   4                    if( 9==n)
  55   4                                   x=0;
C51 COMPILER V8.01   MAIN                                                                  10/18/2009 19:02:33 PAGE 2   

  56   4                                else
  57   4                               x=(n+1);       
  58   4                                onduty = 10*onduty+x;   
  59   4                                printhex(onduty);
  60   4                         }
  61   3      
  62   3                 if(10==n) // key A 
  63   3                            printhex(pwm_getduty());
  64   3        
  65   3                          if(11==n) // key B 
  66   3                             vledmod('A'); 
  67   3                 
  68   3                              if(12==n){ // key C  
  69   4                                  pwm_safeoff();
  70   4                                      if( ( onduty< ADC_CYCLE)&&(onduty>8)){
  71   5                                         x=adc(onduty-8,20);
  72   5                                         x1=adc(onduty-8,20);
  73   5                                      }else
  74   4                                         adc(0,3);
  75   4                                  pwm_safeon();
  76   4                                      onduty=(x+x1)>>1;
  77   4                                      printhex(onduty);
  78   4                                      
  79   4                                      vledmod('A'); 
  80   4                            
  81   4                              }
  82   3                              if(13==n){ // key d 
  83   4                              vledmod('V'); 
  84   4                                  pwm_safeoff();
  85   4                                //    invert_adc();
  86   4                                  pwm_safeon();
  87   4                                      //printhex(x);
  88   4                              
  89   4                          
  90   4                              }
  91   3                              if(15==n){ // key d 
  92   4                             
  93   4                           
  94   4                              }               
  95   3                 
  96   3                      }
  97   2                         
  98   2                      
  99   2                  //segvled_demo();
 100   2                  update_vled(); //vled mode 
 101   2           
 102   2        }
 103   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    416    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     12    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
