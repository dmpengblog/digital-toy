C51 COMPILER V8.01   8X8MATRIX                                                             09/20/2009 21:04:21 PAGE 1   


C51 COMPILER V8.01, COMPILATION OF MODULE 8X8MATRIX
OBJECT MODULE PLACED IN 8x8matrix.OBJ
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE 8x8matrix.c BROWSE DEBUG OBJECTEXTEND

line level    source

   1          
   2          #include <AT89X52.H>
   3          
   4          
   5          /*
   6           *  run about cyc*2+2 cycle
   7           */
   8          void _2cycle(unsigned char cyc)
   9          {
  10   1         while(--cyc);
  11   1         /* DFFE     DJNZ     R7,delay(C:0014), 2cycle*/
  12   1      }
  13          
  14          /*小于6us严重不准确, 奇数非常准确,偶数误差约(+ -)1us(仿真) */
  15          /*7-512us*/
  16          #define udelay(t)  _2cycle((t/2)-2)
  17          
  18          
  19          
  20          /*
  21           * mdelay(0) : 15 cycle, 12Mhz 30us
  22           * 1ms to 256ms
  23           *  +- 50us
  24           */
  25          void mdelay(unsigned char ms)
  26          {
  27   1      
  28   1      /*
  29   1          35:    while(--t){     
  30   1      C:0x0005    1E       DEC      R6               1 cyc
  31   1      C:0x0006    EE       MOV      A,R6                 1 cyc
  32   1      C:0x0007    600C     JZ       C:0015           1 cyc
  33   1          36:      _2cycle(250); 
  34   1      C:0x0009    7FFA     MOV      R7,#0xFA         1 cyc
  35   1      C:0x000B    120027   LCALL    _2cycle(C:0027)   2 cyc
  36   1          37:         _2cycle(250); 
  37   1      C:0x000E    7FFA     MOV      R7,#0xFA             1 cyc
  38   1      C:0x0010    120027   LCALL    _2cycle(C:0027)   2 cyc
  39   1          38:    } 
  40   1      C:0x0013    80F0     SJMP     C:0005           2 cyc
  41   1      */
  42   1         while(ms--){   
  43   2           udelay(489); //补偿12cyc*2 us
  44   2               udelay(499);
  45   2         }
  46   1        
  47   1      }
  48          
  49          /*
  50           * +- 50ms
  51           */
  52          void sleep(unsigned char t)
  53          {
  54   1         while(t--){
  55   2               mdelay(250);
C51 COMPILER V8.01   8X8MATRIX                                                             09/20/2009 21:04:21 PAGE 2   

  56   2               mdelay(250);
  57   2           mdelay(250);
  58   2           mdelay(250);
  59   2         }
  60   1           
  61   1      }
  62          
  63          /* 按行区模(横向取模),
  64             第一行显示点, 第二行显示点...
  65              ---> col
  66             | b1    .
  67             | b2    .
  68           row b3    .
  69                   b4        .
  70          */
  71          unsigned char hztab[]=
  72          {
  73            0x00,0x3C,0x24,0x24,0x24,0x3C,0x00,0x00,  //0
  74            0x00,0x08,0x18,0x08,0x08,0x1C,0x00,0x00,
  75            0x00,0x3C,0x04,0x04,0x3C,0x20,0x3C,0x00,
  76            0x00,0x3C,0x04,0x3C,0x04,0x3C,0x00,0x00,
  77            0x00,0x28,0x28,0x3C,0x08,0x08,0x00,0x00,
  78            0x00,0x3C,0x20,0x3C,0x04,0x3C,0x00,0x00,
  79            0x00,0x3C,0x20,0x3C,0x24,0x3C,0x00,0x00,
  80            0x00,0x3C,0x04,0x08,0x10,0x10,0x00,0x00,
  81            0x00,0x3C,0x24,0x3C,0x24,0x3C,0x00,0x00,
  82            0x00,0x3C,0x24,0x3C,0x24,0x3C,0x00,0x00,  //9
  83          };
  84          
  85          
  86          #define Rrow P2  //Row been pull high!!!
  87          #define Rcol P3
  88          
  89          unsigned char row[]={ 0x1,0x2,0x4,0x8,0x10,0x20,0x40,0x80};
  90          
  91          
  92          show( unsigned char c, int ms)
  93          {
  94   1      
  95   1         unsigned char *tab=hztab+8*c;
  96   1         char i;
  97   1         int t;
  98   1         for(t=0;t<ms;t++)
  99   1           for(i=0;i<8;i++) //scan from row1 to row8
 100   1           {
 101   2              Rrow=row[i];
 102   2              Rcol=~tab[i]; //low to light the led
 103   2                  udelay(500);
 104   2              
 105   2           }
 106   1      }
 107          
 108          void main(void)
 109          {
 110   1         unsigned char i=0; 
 111   1         while(1)
 112   1          {
 113   2                //blink();
 114   2                //blink1();
 115   2            for(i=0; i<9; i++){
 116   3               show(i,250);  //show 1s
 117   3                   sleep(1);
C51 COMPILER V8.01   8X8MATRIX                                                             09/20/2009 21:04:21 PAGE 3   

 118   3                       
 119   3            }
 120   2            
 121   2          }
 122   1      }
 123          
 124                                                   
 125                                          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    169    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     88       8
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
